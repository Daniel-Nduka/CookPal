<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in to your account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .error {
            color: red;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <header class="p-3 mb-3 border-bottom">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <span class="fs-4">CookPal</span>
                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="{% url 'app:homepage' %}" class="nav-link px-2 link-secondary">Homepage</a></li>
                </ul>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="d-flex">
            <div class="container">
                <form class="mb-5 mt-5 mx-5 my-5" id="loginForm" method="post" action="{% url 'app:login' %}">
                    {% csrf_token %}
                    <div>
                        <label for="login-username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="login-username" placeholder="Enter username" name="login-username">
                        <div id="login-username-error" class="error"></div>
                    </div>

                    <div>
                        <label for="login-password" class="form-label mt-3">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Enter password" name="login-password">
                        <div id="login-password-error" class="error"></div>
                    </div>
                    <div class="d-flex justify-content-center align-items-center">
                        <button type="submit" class="btn btn-primary mb-3 mt-3">Log in</button>
                    </div>
                </form>
            </div>

            <div class="vr"></div>
            <div class="container">
                <form class="mb-5 mt-5 mx-5 my-5" id="signupForm" method="post" action="{% url 'app:login' %}">
                    {% csrf_token %}
                    <div>
                        <label for="Signup-username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="Signup-username" placeholder="Enter username" name="Signup-username">
                        <div id="Signup-username-error" class="error"></div>
                    </div>

                    <div>
                        <label for="Signup-password" class="form-label mt-3">Password</label>
                        <input type="password" class="form-control" id="Signup-password" placeholder="Enter password" name="Signup-password">
                        <div id="Signup-password-error" class="error"></div>
                    </div>

                    <div>
                        <label for="Confirm-password" class="form-label mt-3">Confirm Password</label>
                        <input type="password" class="form-control" id="Confirm-password" placeholder="Confirm password" name="Confirm-password">
                        <div id="Confirm-password-error" class="error"></div>
                    </div>

                    <div>
                        <label for="Signup-Nickname" class="form-label mt-3">Nickname</label>
                        <input type="text" class="form-control" id="Signup-Nickname" placeholder="Enter Nickname" name="Signup-Nickname">
                        <div id="Signup-Nickname-error" class="error"></div>
                    </div>

                    <div>
                        <label for="email" class="form-label mt-3">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
                        <div id="email-error" class="error"></div>
                    </div>

                    <div>
                        <label for="phone" class="form-label mt-3">Phone</label>
                        <input type="number" class="form-control" id="phone" placeholder="Enter phone" name="phone">
                        <div id="phone-error" class="error"></div>
                    </div>

                    <div class="d-flex justify-content-center align-items-center">
                        <button type="submit" class="btn btn-primary mb-3 mt-3">Create Account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
        document.addEventListener("DOMContentLoaded", function() {
            const loginForm = document.getElementById("loginForm");
            loginForm.addEventListener("submit", function(event) {
                event.preventDefault();

                // Clear previous errors
                clearErrors();

                // Input validation for login form
                const isUsernameValid = validateField("login-username");
                const isPasswordValid = validateField("login-password");

                if (isUsernameValid && isPasswordValid) {
                    const username = document.getElementById("login-username").value;
                    const password = document.getElementById("login-password").value;
                    console.log("Login Form Submitted");
                    console.log("Username:", username, "Password:", password);
                    submitLoginRequest(username, password)
                }
            });

            const signupForm = document.getElementById("signupForm");
            signupForm.addEventListener("submit", function(event) {
                event.preventDefault();

                // Clear previous errors
                clearErrors();

                let isValid = true;

                // Input validation
                isValid &= validateField("Signup-username");
                isValid &= validateField("Signup-password");
                isValid &= validateField("Signup-Nickname");
                isValid &= validateField("email", true);
                isValid &= validateField("phone");

                // Password match check
                const password = document.getElementById("Signup-password").value;
                const confirmPassword = document.getElementById("Confirm-password").value;
                if (password !== confirmPassword) {
                    displayError("Confirm-password", "Passwords do not match.");
                    isValid = false;
                }

                if (isValid) {
                    const username = document.getElementById("Signup-username").value;
                    const nickname = document.getElementById("Signup-Nickname").value;
                    const email = document.getElementById("email").value;
                    const phone = document.getElementById("phone").value;
                    
                    console.log("Signup Form Submitted");
                    console.log("Username:", username, "Password:", password, "Nickname:", nickname, "Email:", email, "Phone:", phone);
                }
            });

            function submitLoginRequest(username, password) {
                console.log("attempting to submit form")
                $.ajax({
                    type: "POST",
                    headers: {
                        'Content-Type':'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    url: "login/",
                    data: JSON.stringify({'Username': username, 'Password': password}),
                    success: function(json) {
                    console.log("successful request")
                    }
                })
            }

            function validateField(fieldId, isEmail=false) {
                const value = document.getElementById(fieldId).value;
                if (!value) {
                    displayError(fieldId, "This field cannot be empty.");
                    return false;
                } else if (isEmail && (!value.includes("@") || !value.endsWith(".com"))) {
                    displayError(fieldId, "Invalid email format.");
                    return false;
                }
                return true;
            }

            function displayError(fieldId, message) {
                const errorElement = document.getElementById(fieldId + "-error");
                errorElement.textContent = message;
            }

            function clearErrors() {
                const errorElements = document.querySelectorAll(".error");
                errorElements.forEach(error => {
                    error.textContent = "";
                });
            }
        });
    </script>
</body>
</html>
